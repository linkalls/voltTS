# VoltTS v0.1 Specification Snapshot

このドキュメントは、VoltTS v0.1 で優先すべき設計思想と機能セットをまとめたメモです。TS らしい読みやすさと、V/Go/Bun 由来の現実路線を両立させ、まずはネイティブ出力を最優先します。

## 1. コンセプト
- TS に似た見た目と文化を維持しつつ、V/Go のようなシンプルさと Bun 的オールインワン体験を狙う。
- 型は「強い推論 + 構造的型付け + ランタイム非依存」を重視し、型レベル魔術は封印。
- 言語機能を小さく保ち、公式ツールで DX を底上げする。

## 2. 非目標（v0.1 では実装しない）
- 条件型や再帰型などの高度な型計算、巨大標準ライブラリ、過度な最適化。
- JS/WASM 出力を完成条件にしない（計画は持つが後回し）。

## 3. 公式 CLI（言語の顔）
コマンド名: `voltts`

必須サブコマンド（v0.1 完成条件）:
- `voltts init`
- `voltts run <entry>`
- `voltts test`
- `voltts fmt`
- `voltts lint`
- `voltts build`

## 4. フロントエンドの文法方針
- 変数: `const`（推奨）、`let`
- 関数: `fn name(args): ReturnType { ... }`（戻り型は省略可）
- 型定義: `type`, `struct`, `enum`
- モジュール: `import { x } from "pkg"`, `export`
- 非同期構文: `async fn` / `await <call>` を受け付ける（v0.1 では同期的に逐次実行するシンタックスシュガー）。

## 5. 型システム
- 静的型 + 強い型推論 + 構造的型付け、型はランタイム非依存。
- Tier 制で複雑性を管理:
  - Tier 0（標準）: プリミティブ、配列、レコード/オブジェクト、浅い union、1 段のジェネリクス。
  - Tier 1（v0.2 以降）: 制約付きジェネリクス、型ガード。
  - Tier 2（禁止）: 条件型相当、再帰的型レベル計算など。

## 6. Null / Option
- デフォルトは non-null。`T? = T | none` のように明示した場合のみ nullable。

## 7. エラー処理
- 例外は panic 相当の最小限に留め、通常は `Result<T, E>` を基本形にする。
- 標準形: `{ ok: true, value: T } | { ok: false, error: E }`

## 8. 実行・コンパイルモデル
- C へのコード生成を中核にし、ネイティブ出力を最優先。
- パイプライン: parse → AST → 型チェック → C コード生成 → clang/gcc でビルド。
- メモリは v0.1 では GC をデフォルト（`--gc none` や `--arena` は後続バージョン）。

## 9. ビルドターゲット
- v0.1 で保証するのは `--target native` のみ。出力は `./dist/app`（OS ネイティブ）。

## 10. テストランナー
- `voltts test` は Bun 風のビルトイン体験を意識。
- テスト検出パターン: `**/*.test.vts`, `**/*.spec.vts`, `**/*_test.vts`。
- 最小 API: `describe`, `test`/`it`, `beforeEach`, `afterEach`, `expect`。

## 11. フォーマッタ
- `voltts fmt` は gofmt 的な「議論不要の公式スタイル」とし、`--check` もサポート。

## 12. v0.1 実装チェックリスト
1. lexer/parser
2. AST
3. 型推論 + 構造的型チェック
4. `T?`
5. `Result<T, E>`
6. C コード生成
7. `voltts build/run/test/fmt/lint`

## 13. JS/WASM の拡張余地
- v0.1 では C 出力を固める。将来は C→WASM (Emscripten) や直接 JS エミッタを追加する構想。

## 14. 直近のフロントエンド強化ポイント
- 字句解析をトークナイザに切り出し、行区切り依存を解消する。
- Expr/Stmt を分離し、`let` 代入・式文・二項演算・`await` 付き呼び出しを自然に扱う。
- `if`/`else` 分岐とローカル変数を C 生成で出力し、実用的な分岐が書けるようにする。
- 解析エラーにファイル/行/列の Span を付与して診断を改善する。
- 配列・オブジェクトリテラルと標準ライブラリ (env/process/math/json/http) を拡張するのは上記が固まってから着手する。

以上の範囲に開発を集中させることで、
"TS よりスッキリ、Go よりリッチ、V みたいに軽く、Bun みたいに楽" な体験を目指す。
